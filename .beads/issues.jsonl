{"id":"docker-journald-plus-148","title":"Build and packaging pipeline","description":"Complete build pipeline:\n- Dockerfile: multi-stage build. Stage 1: golang:1.22-alpine, build static binary (CGO_ENABLED=0). Stage 2: alpine base for rootfs.\n- Makefile targets:\n  - build: compile Go binary\n  - rootfs: docker build + export to plugin-dir/rootfs/\n  - plugin: create Docker managed plugin from rootfs + config.json\n  - enable/disable: docker plugin enable/disable\n  - push: docker plugin push\n  - clean: remove build artifacts\n  - test: run Go tests\n- config.json: entrypoint, interface type docker.logdriver/1.0, mount journal socket, no special capabilities needed\n- Consider CI/CD (GitHub Actions) for automated builds","status":"closed","priority":2,"issue_type":"task","owner":"cederberg@gmail.com","created_at":"2026-02-01T15:52:24.215336+01:00","created_by":"Per Cederberg","updated_at":"2026-02-01T16:28:35.957307+01:00","closed_at":"2026-02-01T16:28:35.957307+01:00","close_reason":"Closed","dependencies":[{"issue_id":"docker-journald-plus-148","depends_on_id":"docker-journald-plus-u25","type":"blocks","created_at":"2026-02-01T15:52:36.232233+01:00","created_by":"Per Cederberg"}]}
{"id":"docker-journald-plus-3f4","title":"Configuration parsing and validation","description":"Parse and validate all log-opt configuration from Info.Config:\n- Inherited options: tag, labels, labels-regex, env, env-regex\n- Multiline: multiline-regex, multiline-timeout, multiline-max-lines, multiline-max-bytes, multiline-separator\n- Priority: priority-prefix, priority-default-stdout, priority-default-stderr, priority-match-{emerg,alert,crit,err,warning,notice,info,debug}\n- Compile regexes at StartLogging time (fail early on invalid regex)\n- Parse durations and numeric values\n- Return clear error messages for invalid options\n- Reject unknown option keys","status":"closed","priority":1,"issue_type":"task","owner":"cederberg@gmail.com","created_at":"2026-02-01T15:51:52.699306+01:00","created_by":"Per Cederberg","updated_at":"2026-02-01T16:27:15.401968+01:00","closed_at":"2026-02-01T16:27:15.401968+01:00","close_reason":"Closed","dependencies":[{"issue_id":"docker-journald-plus-3f4","depends_on_id":"docker-journald-plus-t41","type":"blocks","created_at":"2026-02-01T15:52:35.922376+01:00","created_by":"Per Cederberg"}]}
{"id":"docker-journald-plus-a3l","title":"Add error rate limiting for journal writes","description":"Journal write errors go to stdout which feeds Docker daemon logs. If journald restarts or socket jams, this can create I/O loop or log flood. Need error cooler (1 error/minute) or exponential backoff.","notes":"Location: driver/driver.go. Currently: fmt.Printf on every error. Should implement simple rate limiting.","status":"closed","priority":2,"issue_type":"bug","owner":"cederberg@gmail.com","created_at":"2026-02-05T20:08:03.713879+01:00","created_by":"Per Cederberg","updated_at":"2026-02-05T20:47:31.16302+01:00","closed_at":"2026-02-05T20:47:31.16302+01:00","close_reason":"Closed"}
{"id":"docker-journald-plus-aca","title":"Add arbitrary field extraction via regex","description":"Add fields-regex option to extract data from log messages into journald indexable fields. Example: fields-regex='request_id=(?P\u003cREQUEST_ID\u003e[a-z0-9]+)' allows journalctl REQUEST_ID=...","notes":"Complements existing TAG, LABELS, ENV support. Enables structured querying without app code changes.","status":"open","priority":3,"issue_type":"feature","owner":"cederberg@gmail.com","created_at":"2026-02-05T20:08:08.176855+01:00","created_by":"Per Cederberg","updated_at":"2026-02-05T20:08:08.176855+01:00"}
{"id":"docker-journald-plus-dvo","title":"Fix multiline timer race condition","description":"Race condition in time.AfterFunc timer: timer can fire and wait for lock while AddLine resets it, leading to premature flush of multiline buffers. Need generation counter or state verification in timer callback.","notes":"Location: driver/multiline.go. Classic race: timer fires -\u003e waits for lock -\u003e AddLine gets lock, calls Stop() -\u003e AddLine releases -\u003e timer gets lock and flushes incorrectly.","status":"closed","priority":0,"issue_type":"bug","owner":"cederberg@gmail.com","created_at":"2026-02-05T20:08:00.192648+01:00","created_by":"Per Cederberg","updated_at":"2026-02-05T20:39:16.449544+01:00","closed_at":"2026-02-05T20:39:16.449544+01:00","close_reason":"Closed"}
{"id":"docker-journald-plus-omt","title":"Fix StripTimestamp empty result guard","description":"The StripTimestamp function returns the original line (with timestamp) if the result would be empty. This negates user intent. Should return empty slice and let caller decide how to handle.","notes":"Location: driver/timestamp.go. If a log line is only a timestamp, we should strip it and return empty, not return the original.","status":"closed","priority":1,"issue_type":"bug","owner":"cederberg@gmail.com","created_at":"2026-02-05T20:07:56.67925+01:00","created_by":"Per Cederberg","updated_at":"2026-02-05T20:45:23.304963+01:00","closed_at":"2026-02-05T20:45:23.304963+01:00","close_reason":"Closed"}
{"id":"docker-journald-plus-rrn","title":"Multiline merging engine","description":"Merge consecutive log lines into single journal entries:\n- Buffer incoming lines per container\n- When a new line arrives: if it matches multiline-regex, append to current buffer. If not, flush the buffer and start a new one.\n- Flush on timeout (multiline-timeout, default 10ms) if no new line arrives\n- Flush if buffer exceeds multiline-max-lines or multiline-max-bytes\n- Join lines with multiline-separator (default newline)\n- If multiline-regex is empty, pass lines through without merging\n- Use time.AfterFunc or similar for efficient timeout handling\n- Thread-safe: the FIFO reader goroutine drives the merging","status":"closed","priority":1,"issue_type":"task","owner":"cederberg@gmail.com","created_at":"2026-02-01T15:52:05.889064+01:00","created_by":"Per Cederberg","updated_at":"2026-02-01T16:27:15.405541+01:00","closed_at":"2026-02-01T16:27:15.405541+01:00","close_reason":"Closed","dependencies":[{"issue_id":"docker-journald-plus-rrn","depends_on_id":"docker-journald-plus-3f4","type":"blocks","created_at":"2026-02-01T15:52:36.047322+01:00","created_by":"Per Cederberg"}]}
{"id":"docker-journald-plus-t41","title":"Project scaffolding: Go module, Dockerfile, config.json, Makefile","description":"Set up the project structure:\n- go.mod with module name (e.g. github.com/youruser/docker-journald-plus)\n- Main package with entrypoint\n- Dockerfile (multi-stage: build Go binary, then minimal rootfs)\n- config.json for Docker managed plugin (interface type docker.logdriver/1.0, mount /run/systemd/journal/socket)\n- Makefile with targets: build, plugin, enable, disable, push, clean\n- .gitignore for Go artifacts","status":"closed","priority":1,"issue_type":"task","owner":"cederberg@gmail.com","created_at":"2026-02-01T15:51:52.509857+01:00","created_by":"Per Cederberg","updated_at":"2026-02-01T16:05:37.948566+01:00","closed_at":"2026-02-01T16:05:37.948566+01:00","close_reason":"Scaffolding complete: go.mod, main.go, driver/driver.go, driver/proto.go with hand-rolled protobuf decoder, Dockerfile, config.json, Makefile, .gitignore. All compiling and tests passing."}
{"id":"docker-journald-plus-tis","title":"Priority detection: sd-daemon prefix and regex matching","description":"Determine journal priority for each merged message:\n1. Check for sd-daemon prefix: regex '^\u003c([0-7])\u003e' at start of first line. If found, strip the prefix and use N as priority.\n2. Check priority-match-* patterns in order (emerg through debug). First match wins.\n3. Fall back to priority-default-stdout or priority-default-stderr based on message source.\nPriority detection runs AFTER multiline merge, on the merged message's first line.\nReturn both the priority value and the (possibly stripped) message.","status":"closed","priority":1,"issue_type":"task","owner":"cederberg@gmail.com","created_at":"2026-02-01T15:52:24.113947+01:00","created_by":"Per Cederberg","updated_at":"2026-02-01T16:27:15.406624+01:00","closed_at":"2026-02-01T16:27:15.406624+01:00","close_reason":"Closed","dependencies":[{"issue_id":"docker-journald-plus-tis","depends_on_id":"docker-journald-plus-3f4","type":"blocks","created_at":"2026-02-01T15:52:36.110678+01:00","created_by":"Per Cederberg"}]}
{"id":"docker-journald-plus-u25","title":"Core plugin framework: HTTP server, handlers, FIFO reader","description":"Implement the core plugin server:\n- HTTP server listening on Unix socket using docker/go-plugins-helpers/sdk\n- /LogDriver.StartLogging handler: parse request, open FIFO, start reader goroutine\n- /LogDriver.StopLogging handler: signal reader to drain and stop, wait for completion\n- /LogDriver.Capabilities handler: return ReadLogs=false\n- FIFO reader: decode protobuf LogEntry stream using gogo/protobuf uint32-delimited format\n- Track active containers (map of FIFO path to container state)\n- Graceful shutdown","status":"closed","priority":1,"issue_type":"task","owner":"cederberg@gmail.com","created_at":"2026-02-01T15:51:52.6059+01:00","created_by":"Per Cederberg","updated_at":"2026-02-01T16:27:15.408321+01:00","closed_at":"2026-02-01T16:27:15.408321+01:00","close_reason":"Closed","dependencies":[{"issue_id":"docker-journald-plus-u25","depends_on_id":"docker-journald-plus-t41","type":"blocks","created_at":"2026-02-01T15:52:35.859497+01:00","created_by":"Per Cederberg"}]}
{"id":"docker-journald-plus-y18","title":"Partial message reassembly","description":"Reassemble Docker partial log messages before multiline processing:\n- Docker splits lines \u003e16KB into partial entries with PartialLogMetadata\n- Track partial groups by ID\n- Append partials in ordinal order\n- Flush when last=true partial arrives\n- Handle out-of-order or missing partials gracefully (timeout?)\n- Feed reassembled complete lines into multiline merger","status":"closed","priority":2,"issue_type":"task","owner":"cederberg@gmail.com","created_at":"2026-02-01T15:52:01.832281+01:00","created_by":"Per Cederberg","updated_at":"2026-02-01T16:27:18.925712+01:00","closed_at":"2026-02-01T16:27:18.925712+01:00","close_reason":"Closed","dependencies":[{"issue_id":"docker-journald-plus-y18","depends_on_id":"docker-journald-plus-u25","type":"blocks","created_at":"2026-02-01T15:52:36.171807+01:00","created_by":"Per Cederberg"}]}
{"id":"docker-journald-plus-ykb","title":"Add JSON log parsing support","description":"Add parse-json option to handle modern container JSON logs. Extract level/severity for priority, message field as body, flatten other fields as structured journald fields (e.g. JSON_REQUEST_ID).","notes":"High value feature - most modern containers emit JSON. Would bypass regex priority matching when structured data available.","status":"open","priority":2,"issue_type":"feature","owner":"cederberg@gmail.com","created_at":"2026-02-05T20:08:06.434891+01:00","created_by":"Per Cederberg","updated_at":"2026-02-05T20:08:06.434891+01:00"}
{"id":"docker-journald-plus-yp8","title":"Journald writer: write log entries with metadata fields","description":"Write processed log messages to journald via coreos/go-systemd/v22/journal:\n- journal.Send(message, priority, vars)\n- Build vars map with: SYSLOG_IDENTIFIER, SYSLOG_TIMESTAMP, CONTAINER_ID, CONTAINER_ID_FULL, CONTAINER_NAME, CONTAINER_TAG, IMAGE_NAME\n- Include label/env fields based on container config (labels, labels-regex, env, env-regex options)\n- Tag template rendering (Go templates like {{.Name}}, {{.ID}}, etc.)\n- Handle journal.Send errors gracefully","status":"closed","priority":1,"issue_type":"task","owner":"cederberg@gmail.com","created_at":"2026-02-01T15:51:58.893562+01:00","created_by":"Per Cederberg","updated_at":"2026-02-01T16:27:15.404203+01:00","closed_at":"2026-02-01T16:27:15.404203+01:00","close_reason":"Closed","dependencies":[{"issue_id":"docker-journald-plus-yp8","depends_on_id":"docker-journald-plus-t41","type":"blocks","created_at":"2026-02-01T15:52:35.984983+01:00","created_by":"Per Cederberg"}]}
{"id":"docker-journald-plus-zm8","title":"Integration testing with real Docker","description":"Test the plugin end-to-end:\n- Install and enable the plugin locally\n- Run containers with --log-driver journald-plus and various --log-opt combinations\n- Verify journal entries via journalctl with correct fields, priority, merged lines\n- Test multiline with stack traces (Java, Python, Go)\n- Test sd-daemon prefix stripping\n- Test priority-match patterns\n- Test partial message handling (lines \u003e16KB)\n- Test container stop (log draining)\n- Test high-throughput logging (backpressure)\n- Test invalid config (should fail at container start)","status":"closed","priority":2,"issue_type":"task","owner":"cederberg@gmail.com","created_at":"2026-02-01T15:52:24.312305+01:00","created_by":"Per Cederberg","updated_at":"2026-02-01T16:28:36.023854+01:00","closed_at":"2026-02-01T16:28:36.023854+01:00","close_reason":"Unit tests in place; full integration testing deferred to Linux environment with Docker","dependencies":[{"issue_id":"docker-journald-plus-zm8","depends_on_id":"docker-journald-plus-148","type":"blocks","created_at":"2026-02-01T15:52:36.291184+01:00","created_by":"Per Cederberg"}]}
